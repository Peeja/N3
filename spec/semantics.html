<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Notation 3 Semantics</title>
    <script
      src="https://www.w3.org/Tools/respec/respec-w3c"
      class="remove"
      defer
    ></script>
    <script class="remove">
      // All config options at https://respec.org/docs/
      var respecConfig = {
        specStatus: "CG-DRAFT",
        editors: [
          {
            "name": "Dörthe Arndt",
            "url": "https://iccl.inf.tu-dresden.de/web/D%C3%B6rthe_Arndt/en",
            "company": "TU Dresden",
            "companyURL": "https://tu-dresden.de/",
            "w3cid": 111308,
          },{
            "name": "Pierre-Antoine Champin",
            "url": "http://champin.net/",
            "company": "W3C",
            "companyURL": "https://www.w3.org/",
            "orcid": "0000-0001-7046-4474",
            "w3cid": 42931,
          },
        ],
        github: "w3c/N3",
        shortName: "n3-semantics",
        xref: "web-platform",
	group: "n3-dev",
        format: "markdown",
      };
    </script>
    <!-- Katex -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css" integrity="sha384-Xi8rHCmBmhbuyyhbI88391ZKP2dmfnOl4rT9ZfRI7mLTdk1wblIUnrIq35nqwEvC" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js" integrity="sha384-X/XCfMm41VSsqRNQgDerQczD69XqmjOOOwYQvr/uuC+j4OPoNhVgjdGFwhvN02Ja" crossorigin="anonymous"></script>
    <!-- To automatically render math in text elements, include the auto-render extension: -->
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"
        onload="renderMathInElement(document.body);"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
          // customised options
          // • auto-render specific keys, e.g.:
          delimiters: [
              {left: '$$', right: '$$', display: true},
              {left: '$', right: '$', display: false},
              {left: '\\(', right: '\\)', display: false},
              {left: '\\[', right: '\\]', display: true}
          ],
          // • rendering keys, e.g.:
          throwOnError : true
        });
    });
    </script>
  </head>
  <body>
    <section id="abstract">
      <p>This is required.</p>
    </section>
    <section id="sotd">
      <p>This is required.</p>
    </section>
    <section class="informative">
      <h2>Introduction</h2>
      <p>Some informative introductory text.</p>
      <aside class="note" title="A useful note">
        <p>I'm a note!</p>
      </aside>
    </section>

    <section>
      <h2>Abstract syntax</h2>
      <p class=issue>
        Should this be a normative section, or a reference to a normative section in the "main" spec?
      </p>
      <p>The set of <dfn>atomic terms</dfn> consists of</p>
      <ul>
        <li>the set $C$ of IRIs,
        <li>the set $L$ of Literals,
        <li>the set $V$ of Variables.
      </ul>
      <p>A <dfn>term</dfn> can be</p>
      <ul>
        <li>an <a>atomic term</a>,
        <li>a (possibly empty) list of <a>terms</a>,
        <li>a <dfn>quoted graph</dfn> $&lt;G&gt;$ where $G$ is a finite <a>graph</a> (see below).
      </ul>
      <p>A <dfn>triple</dfn> is made of</p>
      <ul>
        <li>a term called the <dfn>subject</dfn> of the triple,
        <li>a term called the <dfn>predicate</dfn> of the triple,
        <li>a term called the <dfn>object</dfn> of the triple.
      </ul>
      <p>A <dfn>graph</dfn> is a tuple $(U, E, F)$ where</p>
      <ul>
        <li>$U \subseteq V$ is a (possibly empty) set of <dfn data-lt="universally scoped|universal">universally scoped variables</dfn>,
        <li>$E \subseteq V$ is a (possibly empty) set of <dfn data-lt="existentially scoped|existential">existentially scoped variables</dfn>,
        <li>$F$ is a (possibly empty) set of <a>triples</a>.
      </ul>
      <p>A <a>graph</a> $G=(U, E, F)$ is finite if the sets $U$, $E$ and $F$ are finite.</p>
      <div class=issue>
        Question: RDF does not expect finte graphs. Do we need all graphs to be finite (we should at least expect all cited graphs to be finite, otherwise we cannot quantify over them).
      </div>
      <div class=note>
        In this context, an RDF graph is a graph which does not contain quoted graphs nor lists and for which $U=\emptyset.$
      </div>
      <section>
        <h2>Various definitions</h2>

        <ul>
          <li>A term is a <dfn>direct constituent</dfn> of
          <ul>
            <li>a list $l$ if it is
              <ul>
                <li>an element of $l$, or
                <li>a <a>direct constituent</a> of a list-element of $l$;
              </ul>
            <li>a <a>triple</a> $t$ if it is
              <ul>
                <li>a <a>direct constituent</a> of the <a>subject</a>, <a>predicate</a> or <a>object</a> of $t$, or
                <li>the <a>subject</a>, <a>predicate</a> or <a>object</a> of $t$;
              </ul>
            <li>a <a>graph</a> $G=(U, E, F)$ if it is
              <ul>
                <li>a <a>direct constituent</a> of a <a>triple</a> $t ∈ F$.
              </ul>
          </ul>
          We denote the set of direct constituents of a graph $G$ as $DC(G)$.

          <li>A term is a <dfn>constituent</dfn> of a <a>graph</a> $G_1$ if it is either
            <ul>
              <li>a <a>direct constituent</a> of $G_1$, or
              <li>a <a>constituent</a> of $G_2$, where the <a>quoted graph</a> $&lt;G_2&gt;$ is a <a>direct constituent</a> of $G_1$.
            </ul>

            We denote the set of constituents of a graph $G$ as $C(G)$.

            <p class=note>Note that the definition makes a difference between <a>graphs</a> and <a>quoted graphs</a>. This difference is crucial for the definitions below: a graph is not the same as a quoted graph.</p>

            <li>The set $FV$ of <dfn data-lt="free">free variables</dfn> in a term is defined as follows:
              <ul>
                <li>$FV(x) = ∅$ if $x ∈ C ∪ L$,
                <li>$FV(x) = \{x\}$ if $x ∈ V$,
                <li>$FV(x) = FV(x_1) ∪ … ∪ FV(x_n)$ if $x=(x_1 … x_n)$ is a list,
                <li>$FV(x) = FV(s) ∪ FV(p) ∪ FV(o)$ if $x=(s,p,o)$ is a <a>triple</a>,
                <li>$FV(x) = ⋃_{t ∈ x} FV(t)$ if $x$ is a set of <a>triples</a>,
                <li>$FV(x) = (⋃_{y ∈ DC(F)} FV(y))\setminus(U ∪ E)$ if $x=&lt;(U,E,F)&gt;$ is a <a>quoted graph</a>,
              </ul>

              For a <a>graph</a> $G=(U,E,F)$ and a variable $v\in V\cap C(G)$:
              <ul>
                <li>we say that $v$  is <a>free</a> in $G$ iff $v\not\in U\cup E$ and there exists $x\in DC(G)$ such that $v\in FV(x)$;
                <li>otherwise we call $v$ <dfn data-lt="scoped variable">scoped</dfn> in $G$;
                <li>we denote the set of variables which are <a>free</a> in $G$ as $FV(G)$.
              </ul>

            <li>A <a>graph</a> $G=(U,E,F)$ is <dfn data-lt="closed graph">closed</dfn> if all variables $v\in C(G)\cap V$ are scoped in $G$.

            <li>A term is <dfn data-lt="ground term">ground</dfn> if it is either
              <ul>
                <li>an IRI,
                <li>a Literal,
                <li>a list of <a>ground</a> terms or the empty list,
                <li>a <a>quoted graph</a> $&lt;G&gt;$ if $G$ is <a>closed</a>.
              </ul>

              <p>We denote the set of <a>ground terms</a> as $T_G$.

              <p>A <a>triple</a> is <a>ground</a> if all of its <a>direct constituents</a> are <a>ground</a>.</p>

              <p>A graph $G=(U,E,F)$ is <a>ground</a> if $E=U=\emptyset$ and all <a>triples</a> in $F$ are <a>ground</a>.</p>
        </ul>

        <p>A <a>graph</a> $G=(U,E,F)$ can also contain quantified variables $v\in U\cup E$ which do not occur in any <a>triple</a> of $F$. These variables do not contribute to the interpretation of the graph. In order to simplify our considerations below, we introduce the notion of normalised graphs:</p>

        <p>For each graph $G=(U,E,F)$, we call $G^N=(U\cap (FV(F)), E\cap(FV(F), F))$ the <dfn data-lt="normalised|normalised graph">normalisation</dfn> of $G$.</p>

        <section>
          <h2>Isomorphism</h2>

          <p>A graph $&lt;G=(U,E, F)&gt;$ is called <dfn>quotation-free</dfn> if it does not contain quoted graphs.</p>

          <p>Two <a>quotation-free</a> graphs $G_1=(U_1, E_1, F_1)$ and $G_2=(U_2, E_2, F_2)$ are <dfn>isomorphic</dfn> (that is, they have an identical form) if there is a bijection $M$ between the direct components of the <a>normalisations</a> of the two graphs, such that:</p>

          <ul>
            <li>$M$ maps variables to variables
            <li>$M(lit)=lit$ for all literals $lit$ which are direct constituents of $G_1$,
            <li>$M(iri)=iri$ for all IRIs $iri$ which are direct constituents of $G_1$,
            <li>$M((l_1,\ldots, l_n) )= (M(l_1),\ldots, M(l_n) )$ for all lists $(l_1,\ldots, l_n)$ which are direct constituents of $G_1$,
            <li> $M(E_1)=\{M(x)|x\in E_1\cap FV(F_1)\}=E_2\cap FV(F_2)$,
            <li> $M(U_1)=\{M(x)|x\in U_1\cap FV(F_1)\}=U_2 \cap FV(F_2)$,
            <li>the triple $( s, p, o )$ is in $F_1$ if and only if the triple $( M(s), M(p), M(o) )$ is in $F_2$.
          </ul>

          <p>We call a bijection $M$ fulfilling the requirements above a <dfn>simple isomorphism</dfn> from $G_1$ to $G_2$.</p>

          <p>We write $M(G_1)=G_2$ and $M(F_1)=F_2$ to indicate that $M$ is an isomorphism between the the graphs $G_1$ and $G_2$ and between the sets of triples $F_1$ and $F_2$, respectively.</p>

          <p>In order to extend the above definition to graphs containing quotations, we need an auxiliary notion. For two mappings $M$ and $N$ from constituents to constituents, we define their <dfn>combination</dfn> as follows:</p>

          <ul>
            <li>$M\bullet N(v)=N(v)$ if $v\in dom(N)$
            <li>$M\bullet N(v)=M(v)$ if $v\not\in dom(N)$
          </ul>

          <p>With this definition we can now extend the previous definition.</p>

          <p>Two graphs $G_1=(U_1, E_1, F_1)$ and $G_2=(U_2, E_2, F_2)$ are <a>isomorphic</a> if there is a bijection $M$ between the components of the <a>normalisations</a> of the two graphs and bijections $N_{p,t}$ from variables to variables for each occurrence of a quoted graph $&lt;G_1^\prime&gt;\in DC(F_1)$ in position $p\in\{ subject, predicate, object\}$ in triple $t\in F_1$ such that $M\bullet N_{p,t}$ is an isomorphism from $G_1^\prime$ to a graph $G_2^\prime$ and $&lt;G_2^\prime&gt;\in DC(G_2)$, such that $M$ fulfills the requirements of a <a>simple isomorphism</a> with the following extension for triples containing quoted graphs:</p>

          <ul>
            <li>$M(t=(s,p,o))=(L_{subject,t}(s),L_{predicate,t}(p),L_{object,t}(o))$
              where $L_{p,t}$ is defined as follows:

              $$L_{p,t}(x)= \begin{cases}
                &lt;M\bullet N_{p,t}(G_1^\prime)&gt; \text{if } x=&lt;G_1^\prime&gt; \text{is a quoted graph}\\
                M(x), \text{ else}
              \end{cases}$$

              Concretely, that means, that the triple $t=( s, p, o )$ is in $F_1$ if and only if the triple $(L_{subject,t}(s),L_{predicate,t}(p),L_{object,t}(o))$ is in $F_2$.
          </ul>

          <p>In that case we write $G_1 \simeq G_2$.</p>

          <p class="issue">
            Todo: provide a proof that two isomorphic graphs do have the same meaning. (but that is for below, after the semantics)
          </p>

        </section>
      </section>
    </section>

    <section>
      <h2>Base Semantics</h2>

      <p>A <dfn>basic interpretation</dfn> $I$ is defined by:</p>

      <ul>

        
        <li>a set $Δ_I$ (<dfn>domain</dfn>),
        <li>a mapping $D_I$ (<dfn>denotation</dfn>)  from $C ∪ L$ to $Δ_I$,
          such that its restriction to $C$ is a total mapping,
        <li>a mapping $Q_I$ from ground quoted graphs to ground quoted graphs, such that<ul>

            <li>for any quoted graphs $&lt;G&gt;$ if $Q_1(&lt;G&gt;)=&lt;H&gt; \implies H \simeq G$
            <li>for two quoted graphs $&lt;G_1&gt;$ and $&lt;G_2&gt;$: $G_1 \simeq G_2\implies Q_I(G_1)=Q_I(G_2)$,,
          </ul>
        <li>A subset $EXT_I$ (<dfn>extension</dfn>) of $Δ_I^3$.
      </ul>
    
      <div class="note">
        <p>This definition is generally "compatible" with RDF simple interpretations, with the following superficial changes:</p>
        <ul>
          <li>IR becomes $Δ_I$,
          <li>IP is assumed, without loss of generality, to be a subset of $Δ_I$,
          <li>IS and IL have been merged in $D_I$,
          <li>IEXT can be derived from $EXT_I$; formally: $IEXT(p) = \{(s,o)|(s,p,o) ∈ EXT_I\}$; conversely: $EXT_I = ⋃_{p∈IP} \{(s,p,o)| (s,o) ∈ IEXT(p\}$.
        </ul>
      </div>

    
      <div class="issue">
        <p>In our definition the graphs <code>{_:x :p :o. _:y :p :o}</code> and <code>{_:z :p :o.}</code> do not necessarily  have the same meaning. Is that something we want and should fix? (I think that could be fixed, but I would need to investigate here)</p>
    
        <p>In EYE, both graphs are `log:equalTo`, but do not unify by default: <a href="http://ppr.cs.dal.ca:3002/n3/editor/s/qsjm5gRx">http://ppr.cs.dal.ca:3002/n3/editor/s/qsjm5gRx</a></p>
            
        <p>Decision: they are not equal, but we define `log:equalTo` as in EYE.</p>
      </div>

      <div class="note">
        <p>Note that <code>{:s :p :o}</code> and <code>{@forSome :A. :s :p :o.}</code> are isomorphic.</p>
    
        <p>This has been discussed in the Community group and that is also how EYE and CWM consider them: <a href="http://ppr.cs.dal.ca:3002/n3/editor/s/ctJyZSWM">http://ppr.cs.dal.ca:3002/n3/editor/s/ctJyZSWM</a></p>
      </div>

      <section>
        <h2>Semantic conditions for ground graphs</h2>

        <p>Given $I$ a basic interpretation, we define $I(x) =$</p>

        <ul>
          <li>$D_I(x)$ if $x$ is an IRI or a Literal,
          <li>$(I(x_1), I(x_2),...)$ if $x$ is a list $(x_1, x_2, ...)$ and all $I(x_i)$ are defined,
          <li>$Q_I(x)$ if $x$ is a quoted graph,
          <li>$I(x)=true$ if $x=(s, p ,o)$ is a ground triple and $(I(s), I(p) ,I(o))\in EXT_I$, otherwise $I(x)=false$,
          <li>$I(x)=false$ if $x=F$ is a set of ground triples and $I(t)=false$ for some triple $t\in F$, otherwise $I(x) =true$,
          <li>$I(F)$ if $x=(\emptyset, \emptyset, F)$ is a ground graph
        </ul>
      </section>

    </section>
  </body>
</html>

